# Compose project name for Docker Desktop grouping
name: ${COMPOSE_PROJECT_NAME:-bench}
services:
  dev:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        USERNAME: ${USER:-vscode}
        USER_UID: ${UID:-1000}
        USER_GID: ${GID:-1000}
    container_name: ${CONTAINER_NAME:-bench-dev}
    ports:
      - "${HOST_PORT:-8000}:8000"

    user: "${UID:-1000}:${GID:-1000}"
    volumes:
      # Workspace (includes local workspace directory)
      - ../:/workspace:cached
      # Mount repo root (3 levels up from workspaces/<name>/.devcontainer) for shared scripts
      - ../../..:/repo:ro
      
      # All common mounts (Docker socket, shell configs, git, SSH, GitHub CLI, AI credentials)
      # are now defined in docker-compose.override.yml (symlinked from devcontainer-shared/)
      # This keeps the main file clean and maintainable
    command: sleep infinity
    networks:
      - bench-network
    environment:
      # PATH for user-local binaries (npm, uv, etc)
      - PATH=$HOME/.local/bin:$HOME/.npm-global/bin:$HOME/.cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
      # Disable SSH agent auto-start (SSH files are read-only in container)
      - DISABLE_AUTO_SSH_AGENT=1
      # GitHub token for gh CLI (fallback if gh config mount doesn't work)
      - GH_TOKEN=${GH_TOKEN:-}

networks:
  # Generic bench network for development
  bench-network:
    driver: bridge
