# Shared Docker Compose Override for AI Credentials and Common Mounts
# Version: 1.0.0
#
# This file is automatically merged with docker-compose.yml by Docker Compose.
# It adds AI credential mounts and common configurations to any service.
#
# Usage:
#   1. Symlink this file to your bench's .devcontainer/:
#      ln -s ../../devcontainer-shared/docker-compose.override.yml .
#   
#   2. Or copy to your bench's .devcontainer/:
#      cp ../../devcontainer-shared/docker-compose.override.yml .
#
#   3. Customize service name below to match your docker-compose.yml
#
# The service name must match your main service in docker-compose.yml
# Common names: frappe, main-service, dev, app, etc.

services:
  # ============================================================================
  # IMPORTANT: This override supports multiple service names
  # Docker Compose will only apply overrides to services that exist in the main file
  # ============================================================================
  
  # Generic bench service (workBenches example devcontainer)
  dev: &default-config
    volumes:
      # ========================================================================
      # Docker Socket (for docker-in-docker operations)
      # ========================================================================
      - /var/run/docker.sock:/var/run/docker.sock:rw
      
      # ========================================================================
      # Shell Configurations
      # ========================================================================
      - ~/.zshrc:/home/${USER:-vscode}/.zshrc:ro
      - ~/.bashrc:/home/${USER:-vscode}/.bashrc:ro
      - ~/.oh-my-zsh:/home/${USER:-vscode}/.oh-my-zsh:ro
      - ~/.p10k.zsh:/home/${USER:-vscode}/.p10k.zsh:ro
      
      # ========================================================================
      # Git Configuration
      # ========================================================================
      - ~/.gitconfig:/home/${USER:-vscode}/.gitconfig:ro
      
      # ========================================================================
      # SSH Keys and Configuration
      # ========================================================================
      - ~/.ssh/config:/home/${USER:-vscode}/.ssh/config:ro
      - ~/.ssh/id_ed25519:/home/${USER:-vscode}/.ssh/id_ed25519:ro
      - ~/.ssh/id_ed25519.pub:/home/${USER:-vscode}/.ssh/id_ed25519.pub:ro
      - ~/.ssh/id_rsa_ado:/home/${USER:-vscode}/.ssh/id_rsa_ado:ro
      - ~/.ssh/id_rsa_ado.pub:/home/${USER:-vscode}/.ssh/id_rsa_ado.pub:ro
      - ~/.ssh/known_hosts:/home/${USER:-vscode}/.ssh/known_hosts:ro
      
      # ========================================================================
      # GitHub CLI Configuration
      # ========================================================================
      - ~/.config/gh:/home/${USER:-vscode}/.config/gh:ro
      
      # ========================================================================
      # AI Agent Credentials and Configurations
      # ========================================================================
      
      # Claude (Anthropic)
      - ~/.claude:/home/${USER:-vscode}/.claude:ro
      - ~/.claude.json:/home/${USER:-vscode}/.claude.json:ro
      - ~/.claude/.credentials.json:/home/${USER:-vscode}/.claude/.credentials.json:ro
      
      # Grok (xAI)
      - ~/.grok:/home/${USER:-vscode}/.grok:ro
      
      # Codex (OpenAI/ChatGPT)
      - ~/.codex:/home/${USER:-vscode}/.codex:ro
      
      # GitHub Copilot CLI
      - ~/.copilot-cli:/home/${USER:-vscode}/.copilot-cli:ro
      
      # Gemini CLI
      - ~/.gemini:/home/${USER:-vscode}/.gemini:ro
      
      # Letta Code (memory-first coding agent)
      # Mounts: env (API keys), desktop_data (PostgreSQL/SQLite), desktop_config.json
      - ~/.letta:/home/${USER:-vscode}/.letta:ro
      
      # OpenCode AI
      - ~/.opencode:/home/${USER:-vscode}/.opencode:ro
      
      # Other AI providers can be added here following the same pattern

    # ========================================================================
    # Optional: Environment Variables
    # ========================================================================
    environment:
      # GitHub token fallback (if gh config mount doesn't work)
      - GH_TOKEN=${GH_TOKEN:-}
      
      # PATH additions for user-local binaries
      # Uncomment if your container doesn't already set these
      # - PATH=/home/${USER:-vscode}/.local/bin:/home/${USER:-vscode}/.npm-global/bin:$PATH
      
  # Frappe service (frappeBench devcontainers) - COMMENTED OUT
  # Projects should use 'dev' service name instead
  # Uncomment and customize if your project specifically uses 'frappe' as service name
  # frappe:
  #   <<: *default-config
  #   volumes:
  #     # ========================================================================
  #     # Docker Socket (for docker-in-docker operations)
  #     # ========================================================================
  #     - /var/run/docker.sock:/var/run/docker.sock:rw
  #     
  #     # ========================================================================
  #     # Shell Configurations
  #     # ========================================================================
  #     - ~/.zshrc:/home/${USER:-vscode}/.zshrc:ro
  #     - ~/.bashrc:/home/${USER:-vscode}/.bashrc:ro
  #     - ~/.oh-my-zsh:/home/${USER:-vscode}/.oh-my-zsh:ro
  #     - ~/.p10k.zsh:/home/${USER:-vscode}/.p10k.zsh:ro
  #     
  #     # ========================================================================
  #     # Git Configuration
  #     # ========================================================================
  #     - ~/.gitconfig:/home/${USER:-vscode}/.gitconfig:ro
  #     
  #     # ========================================================================
  #     # SSH Keys and Configuration
  #     # ========================================================================
  #     - ~/.ssh/config:/home/${USER:-vscode}/.ssh/config:ro
  #     - ~/.ssh/id_ed25519:/home/${USER:-vscode}/.ssh/id_ed25519:ro
  #     - ~/.ssh/id_ed25519.pub:/home/${USER:-vscode}/.ssh/id_ed25519.pub:ro
  #     - ~/.ssh/id_rsa_ado:/home/${USER:-vscode}/.ssh/id_rsa_ado:ro
  #     - ~/.ssh/id_rsa_ado.pub:/home/${USER:-vscode}/.ssh/id_rsa_ado.pub:ro
  #     - ~/.ssh/known_hosts:/home/${USER:-vscode}/.ssh/known_hosts:ro
  #     
  #     # ========================================================================
  #     # GitHub CLI Configuration
  #     # ========================================================================
  #     - ~/.config/gh:/home/${USER:-vscode}/.config/gh:ro
  #     
  #     # ========================================================================
  #     # AI Agent Credentials and Configurations
  #     # ========================================================================
  #     
  #     # Claude (Anthropic)
  #     - ~/.claude:/home/${USER:-vscode}/.claude:ro
  #     - ~/.claude.json:/home/${USER:-vscode}/.claude.json:ro
  #     - ~/.claude/.credentials.json:/home/${USER:-vscode}/.claude/.credentials.json:ro
  #     
  #     # Grok (xAI)
  #     - ~/.grok:/home/${USER:-vscode}/.grok:ro
  #     
  #     # Codex (OpenAI/ChatGPT)
  #     - ~/.codex:/home/${USER:-vscode}/.codex:ro
  #     
  #     # GitHub Copilot CLI
  #     - ~/.copilot-cli:/home/${USER:-vscode}/.copilot-cli:ro
  #     
  #     # Gemini CLI
  #     - ~/.gemini:/home/${USER:-vscode}/.gemini:ro
  #     
  #     # Letta Code (memory-first coding agent)
  #     # Mounts: env (API keys), desktop_data (PostgreSQL/SQLite), desktop_config.json
  #     - ~/.letta:/home/${USER:-vscode}/.letta:ro
  #     
  #     # OpenCode AI
  #     - ~/.opencode:/home/${USER:-vscode}/.opencode:ro
  #     
  #     # Other AI providers can be added here following the same pattern
  # 
  #   # ========================================================================
  #   # Optional: Environment Variables
  #   # ========================================================================
  #   environment:
  #     # GitHub token fallback (if gh config mount doesn't work)
  #     - GH_TOKEN=${GH_TOKEN:-}
  #     
  #     # PATH additions for user-local binaries
  #     # Uncomment if your container doesn't already set these
  #     # - PATH=/home/${USER:-vscode}/.local/bin:/home/${USER:-vscode}/.npm-global/bin:$PATH
